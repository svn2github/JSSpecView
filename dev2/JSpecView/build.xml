<?xml version="1.0"?>
<project name="JSpecView" default="compile" basedir=".">
  <description>
	    A JAVA based JCAMP-DX and XML Spectroscopy Viewer
  </description>
	<!--
	For the purpose of easier reading the script
	is divided into following sections:

	  - initialization
	  - compilation
	  - jar
	  - execution
	  - debugging
	  - javadoc
	  - cleanup

	-->	
  <property name="full-name" value="JSpecView" />
  <property name="short-name" value="JSpecView" />
  <property name="unix-name" value="jspecview" />
  <property name="version" value="2.0.20111014" />
  <property name="JSpecViewLib.location" value="../JSpecViewLib"/>
    <path id="JSpecViewLib.classpath">
        <pathelement location="${JSpecViewLib.location}/bin"/>
    </path>
    <path id="JspecView.classpath">
        <pathelement location="bin"/>
        <pathelement location="libs/plugin.jar"/>
        <path refid="JSpecViewLib.classpath"/>
    </path>
  <property name="build" location="bin" />
  <property name="dist" location="dist" />
  <property name="build-classes" location="${build}/classes" />
  <property name="build-lib" location="${build}/lib" />
  <property name="doc" location="doc" />
  <property name="certificate" value="certificate" />
  <property name="bin-dist" location="${dist}/bin" />
  <property name="src-dist" location="${dist}/src" />
  <property name="applet.jar" value="${build}/jspecview.jar" />
  <property name="application.jar" value="${build}/JSVApp.jar" />
  <property name="dist.zip" value="${dist}/JSpecView.zip" />
  <property name="signedapplet.jar" value="${build}/Sjspecview.jar" />
  <property name="img" location="src/jspecview/application/icons" />
  <property name="src" location="src" />
  <property name="lib" location="libs" />
	
   <property environment="env"/>
	
   <target name="init" description="initialise" >
	   <mkdir dir="${build}" />
	   <mkdir dir="${build-classes}" />
	   <mkdir dir="${build-lib}" />
   </target>
	
   <target name="compile" depends="init" description="compile the source">
    <javac srcdir="${src}" destdir="${build-classes}" debug="on" source="1.6" target="1.6">
      <classpath>
        <fileset dir="${lib}">
          <include name="**/*.jar" />
        </fileset>
      </classpath>
    </javac>
  </target>

    <target name="build-subprojects">
        <ant antfile="build.xml" dir="${JSpecViewLib.location}" inheritAll="false" target="build-project">
            <propertyset>
                <propertyref name="build.compiler"/>
            </propertyset>
        </ant>
    </target>

    <target name="build-project" depends="init" >
        <echo message="${ant.project.name}: ${ant.file}"/>
        <javac debug="true" debuglevel="${debuglevel}" destdir="bin" source="${source}" target="${target}">
            <src path="src"/>
            <classpath refid="JspecView.classpath"/>
        </javac>
    </target>
	
   <target name="build" depends="build-subprojects,build-project" />
	

  <target name="jar" depends="compile" description="Create the jspecview Applet Jar" >
    <jar jarfile="${applet.jar}" basedir="JspecView.classpath" >
    </jar>
  </target>

  <target name="signed-applet" id="signed-applet" description="Create SJSpecView, the self-signed applet.">
    <signjar jar="${build-lib}/${unix-name}-${version}.jar"
             signedjar="${build-lib}/S${unix-name}-${version}.jar"
             keystore="${certificate}/JSVcert.store"
             storepass="JSV2011" alias="JSVcert" />
  </target>
	
    <target name="CreateApplicationJar" depends="init,compile" description="Build Standalone Application." >
    <delete file="${application.jar}" quiet="true" />
	 <jar destfile="${application.jar}">
	      <zipfileset dir="${build.classes.dir}" prefix="" />
                  <manifest>
		     <attribute name="Main-Class" value="${main.class}" />
		  </manifest>
	 </jar>
    </target>	
	
   <target name="Run" description="Run the application Mainframe" >
       <java classname="jspecview.application.MainFrame" failonerror="true" fork="yes">
           <classpath refid="JspecView.classpath"/>
       </java>
   </target>

    <target name="javadoc">
        <javadoc access="public" author="true" classpath="../JSpecViewLib/bin;libs/plugin.jar" destdir="doc" nodeprecated="false" nodeprecatedlist="false" noindex="false" nonavbar="false" notree="false" packagenames="jspecview.application.common,jspecview.applet,jspecview.application,jspecview.export,mdidesktop" source="1.6" sourcepath="src" splitindex="true" use="true" version="true"/>
    </target>	

  <target name="doc" depends="compile" description="Create the full api documentation">
    <javadoc sourcepath="${src}" packagenames="*" destdir="${doc}" windowtitle="${short-name} API">
      <doctitle>${full-name} v${version}</doctitle>
        <header>${full-name} v${version}</header>
      <classpath>
        <fileset dir="${lib}">
          <include name="**/*.jar" />
        </fileset>
      </classpath>
    </javadoc>
  </target>

  <target name="clean" description="Remove the dist, doc, and build directories">
    <delete dir="${build}" />
    <delete dir="${dist}" />
    <delete dir="${doc}" />
  </target>
</project>
